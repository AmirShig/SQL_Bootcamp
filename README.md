# Piscine SQL - День 00

## _Реляционная модель данных и SQL_

**Краткое содержание:** Сегодня вы узнаете, как работает реляционная модель, и как получать необходимые данные с использованием основных конструкций SQL.

## Цель и тема дня
Цель этого дня - ознакомление с основами реляционной модели данных и SQL. Задачи будут включать в себя выполнение запросов для извлечения данных из базы данных, а также применение базовых конструкций SQL.

## Темы, затронутые в заданиях
1. **Основы SQL**
2. **Выборки данных**
3. **Сортировка и фильтрация результатов запросов**
4. **Использование различных конструкций SQL**

# День 01 - Piscine SQL

## _Первые шаги в работе с множествами и JOIN в SQL_

**Резюме:** Сегодня вы узнаете, как получать необходимые данные на основе конструкций множеств и простых JOIN в SQL.

## Цели дня
Познакомиться с использованием множеств в реляционных базах данных, освоить операторы объединения и разности множеств, а также научиться применять простые JOIN операции.

## Тема дня
Первые шаги в работе с множествами и JOIN в SQL.

## Темы, затронутые в заданиях
1. Использование операторов множеств: UNION, EXCEPT, INTERSECT.
2. Применение JOIN операций: JOIN, NATURAL JOIN.
3. Работа с дубликатами и уникальными значениями.
4. Использование подзапросов.
5. Работа с условиями IN и EXISTS.
6. Работа с ORDER BY для упорядочивания результатов.

# Piscine SQL - День 02

## Цель дня
Глубокое изучение операций JOIN в SQL, особенно различных типов JOIN.

## Тема дня
Работа с различными структурами JOIN в SQL.

## Затронутые темы
1. Реляционная алгебра и ее использование для оптимизации и семантических запросов.
2. Типы JOIN в реляционной алгебре: Cross Join, Natural Join, Theta Join, Semi Join, Anti Join, Left/Right/Full Joins.
3. Оптимизация планов запросов.
4. Использование Common Table Expressions (CTE) в SQL.
5. Практические задания с использованием базы данных, содержащей таблицы о пиццериях, клиентах, меню, заказах и посещениях.

# Piscine SQL - Day 03

## Цель дня
Продолжить изучение операторов JOIN и внести изменения в данные с использованием DML (Data Manipulation Language) в языке SQL.

## Тема дня
Изучение операторов вставки (INSERT), обновления (UPDATE) и удаления (DELETE) данных в контексте реляционной теории баз данных.

## Темы, затронутые в заданиях
1. **INSERT, UPDATE, DELETE в математическом контексте:** Рассмотрены математические аспекты операторов INSERT, UPDATE и DELETE.
2. **Использование CTE (Common Table Expressions):** В заданиях использованы общие табличные выражения для выполнения сложных операций.
3. **Сравнение данных и анализ посещений:** Задания включают сравнение и анализ данных о посещениях различных пиццерий.
4. **Объединение таблиц и работа с множествами данных:** Применение операторов UNION, EXCEPT, INTERSECT для объединения и сравнения данных.
5. **Изменение цен и добавление новых элементов:** Задания включают изменение цен на продукцию и добавление новых пицц в меню.
6. **Работа с динамическими данными:** Регистрация новых посещений и заказов, используя динамические данные и внешние запросы.

# День 04 - Piscine SQL

## _Снимки, виртуальные таблицы... Что здесь происходит?_

## Цель дня
Научиться использовать виртуальные представления (views) и материализованные представления (materialized views) в базах данных.

## Темы, затронутые в заданиях
1. Создание виртуальных представлений (Database Views).
2. Работа с виртуальными представлениями на основе фильтрации данных.
3. Создание материализованных представлений (Materialized Views).
4. Обновление данных в материализованных представлениях.
5. Удаление созданных в процессе решения задач виртуальных таблиц и материализованных представлений.

# Day 05 - Piscine SQL

## _I improved my SQL Query! Please, provide proof!_

**Цель дня:** 
Научиться использовать индексы для оптимизации SQL-запросов.

**Тема дня:** 
Создание и использование базовых и функциональных индексов для улучшения производительности запросов.

**Темы затронутые в заданиях:**
1. Создание BTree индексов для внешних ключей.
2. Понимание и демонстрация работы индексов через `EXPLAIN ANALYZE`.
3. Создание функциональных индексов.
4. Создание многоколоночных индексов.
5. Создание уникальных индексов.
6. Создание частично уникальных индексов.
7. Оптимизация производительности SQL-запросов с использованием индексов.

# Day 06 - Piscine SQL

## _Let's improve customer experience_

**Цель дня:**
Научиться добавлять новый бизнес-функционал в модель данных и познакомиться с вопросами о структуре базы данных.

**Тема дня:**
Добавление новых возможностей для повышения удовлетворенности клиентов в базе данных.

**Темы, затронутые в упражнениях:**
1. Добавление новых таблиц и связей в модель данных.
2. Работа с оконными функциями SQL.
3. Использование индексов для улучшения производительности.
4. Работа с уникальными индексами и ограничениями целостности данных.
5. Добавление ограничений на столбцы и управление значениями по умолчанию.
6. Комментирование таблиц и столбцов для соответствия политикам управления данными.
7. Создание базы данных и настройка автоматической генерации первичных ключей.

# Day 07 - Piscine SQL

## _Aggregated data is more informative, isn't it?_

### 1. **Цель дня**
Научиться использовать специфические конструкции OLAP для получения ценной информации из данных.

### 2. **Тема дня**
Агрегирование данных и применение OLAP-конструкций для получения значимой информации.

### 3. **Темы, затронутые в заданиях**
- Продвинутая агрегация данных
- Использование конструкций OLAP (Online Analytical Processing)
- Анализ статистики ресторанов и посетителей
- Группировка данных и использование клозов


# Piscine SQL: Day 08

## **Цель дня**
Изучение изоляции в транзакциях баз данных, понимание аномалий и использование уровней изоляции.

## **Тема дня**
Изоляция как одно из свойств ACID (Atomicity, Consistency, Isolation, Durability) в контексте баз данных.

## Темы, затронутые в заданиях
1. Простые транзакции.
2. Уровни изоляции и изоляционные аномалии:
   - Lost Update Anomaly.
   - Lost Update для уровня REPEATABLE READ.
   - Non-Repeatable Reads Anomaly для уровня READ COMMITTED.
   - Non-Repeatable Reads для уровня SERIALIZABLE.
   - Phantom Reads Anomaly для уровня READ COMMITTED.
   - Phantom Reads для уровня REPEATABLE READ.
   - Deadlock.

## **Темы занятия**

1. **Простая транзакция**
   - Использование двух параллельных сессий для изменений в базе данных.
   - Демонстрация того, как изменения видны или не видны параллельным сессиям до коммита.

2. **Аномалия потери обновлений (Lost Update)**
   - Иллюстрация ситуации, когда одна транзакция перезаписывает изменения другой до их сохранения.

3. **Потеря обновлений при повторяемом чтении (Lost Update for Repeatable Read)**
   - Изучение аномалии потери обновлений, но при использовании уровня изоляции "REPEATABLE READ".

4. **Аномалия неповторяемого чтения (Non-Repeatable Reads)**
   - Иллюстрация ситуации, когда результат чтения в транзакции может измениться из-за изменений в другой транзакции.

5. **Неповторяемые чтения для сериализации (Non-Repeatable Reads for Serialization)**
   - Исследование аномалии неповторяемого чтения при использовании уровня изоляции "SERIALIZABLE".

6. **Аномалия появления новых данных (Phantom Reads)**
   - Демонстрация ситуации, когда транзакция видит новые данные, добавленные другой транзакцией.

7. **Появление новых данных при повторяемом чтении (Phantom Reads for Repeatable Read)**
   - Рассмотрение аномалии появления новых данных при использовании уровня изоляции "REPEATABLE READ".

8. **Взаимоблокировка (Deadlock)**
   - Репродукция ситуации взаимоблокировки в базе данных.

---

*Примечание: Каждая тема включает в себя выполнение соответствующего упражнения с использованием SQL и демонстрацию изменений в параллельных сессиях для лучшего понимания изоляции в базах данных.*

# Piscine SQL: День 09

## Цель дня
Научиться создавать и использовать функциональные блоки в базах данных, а также освоить аудит и триггеры для отслеживания изменений.

## Тема дня
Введение в функциональное программирование в контексте реляционных баз данных. Работа с триггерами, представлениями и функциями в PostgreSQL.

## Темы, затронутые в заданиях
1. Создание таблицы с использованием аудита для отслеживания вставок.
2. Реализация аудита для отслеживания обновлений.
3. Работа с аудитом для отслеживания удалений.
4. Объединение всех трех видов аудита в один главный триггер.
5. Сравнение между созданием представления и функции в базе данных.
6. Создание параметризированной функции в базе данных.
7. Использование pl/pgsql функции для выполнения сложных запросов.
8. Написание функции для нахождения минимального значения из массива.
9. Реализация алгоритма Фибоначчи в функции базы данных.

---

# Piscine SQL - Команда 00

## _Проблема коммивояжера_

**Цель дня:** Разработать быстрое решение на SQL для решения задачи коммивояжера.

**Тема дня:** Решение задачи коммивояжера с использованием SQL.

## Содержание заданий

### [Exercise 00 - Классическая задача коммивояжера](ex00/team00_ex00.sql)
- Создание таблицы "nodes" с структурой {point1, point2, cost} и заполнение данными.
- Написание SQL-запроса, возвращающего все маршруты с минимальной стоимостью путешествия, начиная с города "a".

### [Exercise 01 - Обратная задача коммивояжера](ex01/team00_ex01.sql)
- Добавление возможности просмотра дополнительных строк с максимальной стоимостью в предыдущем SQL-запросе.

## Темы, затронутые в заданиях
1. Создание таблицы и заполнение данными.
2. Использование рекурсивных запросов для решения задачи коммивояжера.
3. Сортировка данных по стоимости и маршруту.
4. Работа с данными о городах и стоимости путешествий между ними.

# Piscine SQL - Команда 01

## _Хранилище данных_

**Цель дня:** Ознакомиться с понятием хранилища данных (DWH) и научиться создавать первый процесс ETL.

**Тема дня:** Работа с хранилищем данных и создание процесса ETL.

## Содержание заданий

### [Exercise 00 - Классическое хранилище данных (DWH)](ex00/team01_ex00.sql)
- Создание SQL-запроса, возвращающего общий объем (сумму) всех транзакций по балансу пользователя, сгруппированных по пользователю и типу баланса.
- Обработка данных с учетом всех аномалий.

### [Exercise 01 - Детализированный запрос](ex01/team01_ex01.sql)
- Создание SQL-запроса, возвращающего всех пользователей и все транзакции по балансу (игнорирование валют, для которых нет ключа в таблице `Currency`).
- Расчет значения валюты в USD для ближайшего дня.

## Темы, затронутые в заданиях
1. Создание запросов для хранилища данных.
2. Использование ETL-процессов (извлечение, трансформация, загрузка).
3. Работа с данными из различных источников.
4. Обработка данных с учетом аномалий и отсутствующих значений.
5. Расчет валюты в USD на основе курса обмена и времени.
